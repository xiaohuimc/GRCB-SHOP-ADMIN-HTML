"use strict";(self["webpackChunkadmin"]=self["webpackChunkadmin"]||[]).push([[229],{24229:function(e,t,i){i.r(t),i.d(t,{default:function(){return f}});var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content-page"},[t("div",{staticClass:"content-nav"},[t("el-breadcrumb",{staticClass:"breadcrumb",attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{name:"ad"}}},[e._v("广告列表")]),t("el-breadcrumb-item",[e._v(e._s(e.infoForm.id?"编辑广告":"添加广告"))])],1),t("div",{staticClass:"operation-nav"},[t("el-button",{attrs:{type:"primary",icon:"arrow-left"},on:{click:e.goBackPage}},[e._v("返回列表")])],1)],1),t("div",{staticClass:"content-main"},[t("div",{staticClass:"form-table-box"},[t("el-form",{ref:"infoForm",attrs:{rules:e.infoRules,model:e.infoForm,"label-width":"120px"}},[e.infoForm.image_url?t("el-form-item",{staticClass:"image-uploader-diy new-height",attrs:{label:"广告图片",prop:"image_url"}},[t("div",{staticClass:"index-image"},[e.infoForm.image_url?t("el-image",{staticClass:"image-show",attrs:{"preview-src-list":e.previewList,src:e.infoForm.image_url,fit:"cover"},on:{click:e.previewIndexImg}}):e._e(),t("div",{staticClass:"o-shadow",on:{click:e.delePicList}},[t("i",{staticClass:"el-icon-delete"})])],1)]):e._e(),e.infoForm.image_url?e._e():t("el-form-item",{attrs:{label:"广告图片",prop:"image_url"}},[t("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{name:"file",action:e.qiniuZone,"on-success":e.handleSuccess,"before-upload":e.getQiniuToken,"auto-upload":!0,"list-type":"picture-card",data:e.picData,"http-request":e.uploadIndexImg}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件")])],1)],1),t("el-form-item",{attrs:{label:"商品类型"}},[t("el-radio-group",{model:{value:e.infoForm.link_type,callback:function(t){e.$set(e.infoForm,"link_type",t)},expression:"infoForm.link_type"}},[t("el-radio",{attrs:{label:0}},[e._v("商品id")]),t("el-radio",{attrs:{label:1}},[e._v("链接")])],1)],1),1==e.infoForm.link_type?t("el-form-item",{attrs:{label:"广告链接",prop:"link"}},[t("el-input",{staticClass:"link-input",model:{value:e.infoForm.link,callback:function(t){e.$set(e.infoForm,"link",t)},expression:"infoForm.link"}})],1):e._e(),0==e.infoForm.link_type?t("el-form-item",{attrs:{label:"商品id",prop:"link"}},[t("el-input",{staticClass:"id-input",model:{value:e.infoForm.goods_id,callback:function(t){e.$set(e.infoForm,"goods_id",t)},expression:"infoForm.goods_id"}}),t("el-popover",{attrs:{placement:"right"},model:{value:e.related_pop,callback:function(t){e.related_pop=t},expression:"related_pop"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.chooseRelateGoods,stripe:""}},[t("el-table-column",{attrs:{prop:"id",label:"id",width:"100"}}),t("el-table-column",{attrs:{prop:"list_pic_url",label:"商品图片",width:"120"},scopedSlots:e._u([{key:"default",fn:function(e){return[t("img",{staticStyle:{width:"40px",height:"40px"},attrs:{src:e.row.list_pic_url,alt:""}})]}}],null,!1,2827108702)}),t("el-table-column",{attrs:{prop:"name",label:"商品名称",width:"300px"}}),t("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.relateSelect(i.row.id)}}},[e._v("选择 ")])]}}],null,!1,1421910715)})],1),t("el-button",{attrs:{slot:"reference",type:"primary"},on:{click:e.relateGoodsClick},slot:"reference"},[e._v("添加关联商品")])],1)],1):e._e(),t("el-form-item",{attrs:{label:"结束时间",prop:"end_time"}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期","default-time":"23:59:59"},model:{value:e.infoForm.end_time,callback:function(t){e.$set(e.infoForm,"end_time",t)},expression:"infoForm.end_time"}},[e._v(" > ")])],1),t("el-form-item",{attrs:{label:"排序",prop:"sort_order"}},[t("el-input-number",{attrs:{min:1,max:999},model:{value:e.infoForm.sort_order,callback:function(t){e.$set(e.infoForm,"sort_order",t)},expression:"infoForm.sort_order"}})],1),t("el-form-item",{attrs:{label:"广告启用"}},[t("el-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:e.infoForm.enabled,callback:function(t){e.$set(e.infoForm,"enabled",t)},expression:"infoForm.enabled"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmitInfo}},[e._v("确定保存")]),t("el-button",{on:{click:e.goBackPage}},[e._v("取消")])],1)],1)],1)])])},a=[],r=(i(57658),i(70636)),l=i(20089),s=i.n(l),n=i(36797),m=i.n(n),d={data(){return{qiniuZone:"",root:"",fileList:[],infoForm:{id:0,image_url:"",link_type:0,enabled:0,end_time:"",goods_id:0,link:""},infoRules:{image_url:[{required:!0,message:"请输入广告图片",trigger:"blur"}],end_time:[{required:!0,message:"请选择时间",trigger:"blur"}]},picData:{token:""},url:"",chooseRelateGoods:[],related_pop:!1,previewList:[]}},methods:{handleSuccess(){},previewIndexImg(){let e=this;e.previewList=[],e.previewList.push(e.infoForm.image_url)},delePicList(){let e=this;e.$confirm("确定删除该图片?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{e.infoForm.image_url=""})).catch((()=>{}))},uploadIndexImg(e){const t=e.file;s()(t).then((e=>{const i={headers:{"Content-Type":"multipart/form-data"}},o=m()().format("YYYYMMDDHHmmssSSS")+Math.floor(100*Math.random())+t.name,a=new FormData;a.append("file",e.file),a.append("token",this.picData.token),a.append("key",o),this.$http.post(this.qiniuZone,a,i).then((e=>{this.handleUploadImageSuccess(e.data)}))})).catch((function(e){console.log(e)}))},handleUploadImageSuccess(e,t){let i=this.url;this.infoForm.image_url=i+e.key},relateSelect(e){console.log(e),this.infoForm.goods_id=e,this.related_pop=!1},relateGoodsClick(){this.axios.post("ad/getallrelate",{id:this.infoForm.id}).then((e=>{0===e.data.errno&&(this.chooseRelateGoods=e.data.data)}))},test(){console.log(this.infoForm.end_time)},beforeAdRemove(){return this.$confirm("确定移除？")},adRemove(e,t){this.infoForm.image_url=""},getQiniuToken(){let e=this;this.axios.post("index/getQiniuToken").then((t=>{let i=t.data.data;console.log(i),e.picData.token=i.token,e.url=i.url}))},goBackPage(){this.$router.go(-1)},onSubmitInfo(){console.log(this.infoForm);let e=this.infoForm.end_time;return 0==e?(this.$message({type:"error",message:"请选择时间"}),!1):0==this.infoForm.link_type&&0==this.infoForm.goods_id?(this.$message({type:"error",message:"请选择商品"}),!1):1==this.infoForm.link_type&&""==this.infoForm.link?(this.$message({type:"error",message:"请输入链接"}),!1):void this.$refs["infoForm"].validate((e=>{if(!e)return!1;this.axios.post("ad/store",this.infoForm).then((e=>{0===e.data.errno?(this.$message({type:"success",message:"保存成功"}),this.$router.go(-1)):100===e.data.errno?this.$message({type:"error",message:"该商品已经有广告关联"}):this.$message({type:"error",message:"保存失败"})}))}))},getInfo(){if(this.infoForm.id<=0)return!1;let e=this;this.axios.get("ad/info",{params:{id:e.infoForm.id}}).then((t=>{let i=t.data.data;i.enabled=i.enabled?"1":"0",e.infoForm=i,e.infoForm.end_time=1e3*i.end_time;let o={name:i.name,url:i.image_url};this.fileList.push(o),console.log(this.infoForm)}))}},components:{},mounted(){this.infoForm.id=this.$route.query.id||0,this.getInfo(),this.root=r.Z.rootUrl,this.getQiniuToken(),this.qiniuZone=r.Z.qiniu}},c=d,p=i(1001),u=(0,p.Z)(c,o,a,!1,null,"eda6548e",null),f=u.exports}}]);
//# sourceMappingURL=229.798c22eb.js.map