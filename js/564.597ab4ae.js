"use strict";(self["webpackChunkadmin"]=self["webpackChunkadmin"]||[]).push([[564],{48234:function(e,t,i){i.d(t,{Z:function(){return y}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"el-form-item",class:[{"el-form-item--feedback":e.elForm&&e.elForm.statusIcon,"is-error":"error"===e.validateState,"is-validating":"validating"===e.validateState,"is-success":"success"===e.validateState,"is-required":e.isRequired||e.required,"is-no-asterisk":e.elForm&&e.elForm.hideRequiredAsterisk},e.sizeClass?"el-form-item--"+e.sizeClass:""]},[t("label-wrap",{attrs:{"is-auto-width":e.labelStyle&&"auto"===e.labelStyle.width,"update-all":"auto"===e.form.labelWidth}},[e.label||e.$slots.label?t("label",{staticClass:"el-form-item__label",style:e.labelStyle,attrs:{for:e.labelFor}},[e._t("label",(function(){return[e._v(e._s(e.label+e.form.labelSuffix))]}))],2):e._e()]),t("div",{staticClass:"el-form-item__content",style:e.contentStyle},[e._t("default"),t("transition",{attrs:{name:"el-zoom-in-top"}},["error"===e.validateState&&e.showMessage&&e.form.showMessage?e._t("error",(function(){return[t("div",{staticClass:"el-form-item__error",class:{"el-form-item__error--inline":"boolean"===typeof e.inlineMessage?e.inlineMessage:e.elForm&&e.elForm.inlineMessage||!1}},[e._v(" "+e._s(e.validateMessage)+" ")])]}),{error:e.validateMessage}):e._e()],2)],2)],1)},a=[],o=i(62480);function s(e,t,i){this.$children.forEach((r=>{var a=r.$options.componentName;a===e?r.$emit.apply(r,[t].concat(i)):s.apply(r,[e,t].concat([i]))}))}var l={methods:{dispatch(e,t,i){var r=this.$parent||this.$root,a=r.$options.componentName;while(r&&(!a||a!==e))r=r.$parent,r&&(a=r.$options.componentName);r&&r.$emit.apply(r,[t].concat(i))},broadcast(e,t,i){s.call(this,e,t,i)}}},n=i(72079);Object.prototype.hasOwnProperty;function d(){}function m(e,t,i){let r=e;t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");let a=t.split("."),o=0;for(let s=a.length;o<s-1;++o){if(!r&&!i)break;let e=a[o];if(!(e in r)){if(i)throw new Error("please transfer a valid prop path to form item!");break}r=r[e]}return{o:r,k:a[o],v:r?r[a[o]]:null}}var h,u,c={props:{isAutoWidth:Boolean,updateAll:Boolean},inject:["elForm","elFormItem"],render(){const e=arguments[0],t=this.$slots.default;if(!t)return null;if(this.isAutoWidth){const i=this.elForm.autoLabelWidth,r={};if(i&&"auto"!==i){const e=parseInt(i,10)-this.computedWidth;e&&(r.marginLeft=e+"px")}return e("div",{class:"el-form-item__label-wrap",style:r},[t])}return t[0]},methods:{getLabelWidth(){if(this.$el&&this.$el.firstElementChild){const e=window.getComputedStyle(this.$el.firstElementChild).width;return Math.ceil(parseFloat(e))}return 0},updateLabelWidth(e="update"){this.$slots.default&&this.isAutoWidth&&this.$el.firstElementChild&&("update"===e?this.computedWidth=this.getLabelWidth():"remove"===e&&this.elForm.deregisterLabelWidth(this.computedWidth))}},watch:{computedWidth(e,t){this.updateAll&&(this.elForm.registerLabelWidth(e,t),this.elFormItem.updateComputedLabelWidth(e))}},data(){return{computedWidth:0}},mounted(){this.updateLabelWidth("update")},updated(){this.updateLabelWidth("update")},beforeDestroy(){this.updateLabelWidth("remove")}},f=c,p=i(1001),g=(0,p.Z)(f,h,u,!1,null,null,null),b=g.exports,v={name:"ElFormItem",componentName:"ElFormItem",mixins:[l],provide(){return{elFormItem:this}},inject:["elForm"],props:{label:String,labelWidth:String,prop:String,required:{type:Boolean,default:void 0},rules:[Object,Array],error:String,validateStatus:String,for:String,inlineMessage:{type:[String,Boolean],default:""},showMessage:{type:Boolean,default:!0},size:String},components:{LabelWrap:b},watch:{error:{immediate:!0,handler(e){this.validateMessage=e,this.validateState=e?"error":""}},validateStatus(e){this.validateState=e}},computed:{labelFor(){return this.for||this.prop},labelStyle(){const e={};if("top"===this.form.labelPosition)return e;const t=this.labelWidth||this.form.labelWidth;return t&&(e.width=t),e},contentStyle(){const e={},t=this.label;if("top"===this.form.labelPosition||this.form.inline)return e;if(!t&&!this.labelWidth&&this.isNested)return e;const i=this.labelWidth||this.form.labelWidth;return"auto"===i?"auto"===this.labelWidth?e.marginLeft=this.computedLabelWidth:"auto"===this.form.labelWidth&&(e.marginLeft=this.elForm.autoLabelWidth):e.marginLeft=i,e},form(){let e=this.$parent,t=e.$options.componentName;while("ElForm"!==t)"ElFormItem"===t&&(this.isNested=!0),e=e.$parent,t=e.$options.componentName;return e},fieldValue(){const e=this.form.model;if(!e||!this.prop)return;let t=this.prop;return-1!==t.indexOf(":")&&(t=t.replace(/:/,".")),m(e,t,!0).v},isRequired(){let e=this.getRules(),t=!1;return e&&e.length&&e.every((e=>!e.required||(t=!0,!1))),t},_formSize(){return this.elForm.size},elFormItemSize(){return this.size||this._formSize},sizeClass(){return this.elFormItemSize||(this.$ELEMENT||{}).size}},data(){return{validateState:"",validateMessage:"",validateDisabled:!1,validator:{},isNested:!1,computedLabelWidth:""}},methods:{validate(e,t=d){this.validateDisabled=!1;const i=this.getFilteredRule(e);if((!i||0===i.length)&&void 0===this.required)return t(),!0;this.validateState="validating";const r={};i&&i.length>0&&i.forEach((e=>{delete e.trigger})),r[this.prop]=i;const a=new o["default"](r),s={};s[this.prop]=this.fieldValue,a.validate(s,{firstFields:!0},((e,i)=>{this.validateState=e?"error":"success",this.validateMessage=e?e[0].message:"",t(this.validateMessage,i),this.elForm&&this.elForm.$emit("validate",this.prop,!e,this.validateMessage||null)}))},clearValidate(){this.validateState="",this.validateMessage="",this.validateDisabled=!1},resetField(){this.validateState="",this.validateMessage="";let e=this.form.model,t=this.fieldValue,i=this.prop;-1!==i.indexOf(":")&&(i=i.replace(/:/,"."));let r=m(e,i,!0);this.validateDisabled=!0,Array.isArray(t)?r.o[r.k]=[].concat(this.initialValue):r.o[r.k]=this.initialValue,this.$nextTick((()=>{this.validateDisabled=!1})),this.broadcast("ElTimeSelect","fieldReset",this.initialValue)},getRules(){let e=this.form.rules;const t=this.rules,i=void 0!==this.required?{required:!!this.required}:[],r=m(e,this.prop||"");return e=e?r.o[this.prop||""]||r.v:[],[].concat(t||e||[]).concat(i)},getFilteredRule(e){const t=this.getRules();return t.filter((t=>!t.trigger||""===e||(Array.isArray(t.trigger)?t.trigger.indexOf(e)>-1:t.trigger===e))).map((e=>(0,n.Z)({},e)))},onFieldBlur(){this.validate("blur")},onFieldChange(){this.validateDisabled?this.validateDisabled=!1:this.validate("change")},updateComputedLabelWidth(e){this.computedLabelWidth=e?`${e}px`:""},addValidateEvents(){const e=this.getRules();(e.length||void 0!==this.required)&&(this.$on("el.form.blur",this.onFieldBlur),this.$on("el.form.change",this.onFieldChange))},removeValidateEvents(){this.$off()}},mounted(){if(this.prop){this.dispatch("ElForm","el.form.addField",[this]);let e=this.fieldValue;Array.isArray(e)&&(e=[].concat(e)),Object.defineProperty(this,"initialValue",{value:e}),this.addValidateEvents()}},beforeDestroy(){this.dispatch("ElForm","el.form.removeField",[this])}},F=v,_=(0,p.Z)(F,r,a,!1,null,null,null),y=_.exports},76564:function(e,t,i){i.r(t),i.d(t,{default:function(){return h}});var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"content-page"},[t("div",{staticClass:"content-nav"},[t("el-breadcrumb",{staticClass:"breadcrumb",attrs:{separator:"/"}},[t("el-breadcrumb-item",{attrs:{to:{name:"nature"}}},[e._v("商品设置")]),t("el-breadcrumb-item",[e._v(e._s(e.infoForm.id?"编辑分类":"添加分类"))])],1),t("div",{staticClass:"operation-nav"},[t("el-button",{attrs:{type:"primary",icon:"arrow-left"},on:{click:e.goBackPage}},[e._v("返回列表")])],1)],1),t("div",{staticClass:"content-main"},[t("div",{staticClass:"form-table-box"},[t("el-form",{ref:"infoForm",attrs:{rules:e.infoRules,model:e.infoForm,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"分类名称",prop:"name"}},[t("el-input",{model:{value:e.infoForm.name,callback:function(t){e.$set(e.infoForm,"name",t)},expression:"infoForm.name"}})],1),t("el-form-item",{attrs:{label:"简短介绍"}},[t("el-input",{attrs:{type:"textarea",rows:1},model:{value:e.infoForm.front_name,callback:function(t){e.$set(e.infoForm,"front_name",t)},expression:"infoForm.front_name"}}),t("div",{staticClass:"form-tip"})],1),0==e.infoForm.parent_id?t("el-form-item",{attrs:{label:"分类图片",prop:"img_url"}},[e.infoForm.img_url?t("img",{staticClass:"image-show",attrs:{src:e.infoForm.img_url}}):e._e(),t("el-upload",{staticClass:"upload-demo",attrs:{name:"file",action:e.qiniuZone,"on-remove":e.bannerRemove,"before-remove":e.beforeBannerRemove,"file-list":e.fileList,"on-success":e.handleUploadBannerSuccess,data:e.picData,"before-upload":e.getQiniuToken}},[e.infoForm.img_url?e._e():t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),t("div",{staticClass:"form-tip"},[e._v("图片尺寸：顶级分类为690*自定义, 只能上传jpg/png文件")])],1):e._e(),0==e.infoForm.parent_id?t("el-form-item",{attrs:{label:"分类图片高度",prop:"name"}},[t("el-input",{model:{value:e.infoForm.p_height,callback:function(t){e.$set(e.infoForm,"p_height",t)},expression:"infoForm.p_height"}})],1):e._e(),0==e.infoForm.parent_id?t("el-form-item",{attrs:{label:"图标",prop:"icon_url"}},[e.infoForm.icon_url?t("img",{staticClass:"image-show",attrs:{src:e.infoForm.icon_url}}):e._e(),t("el-upload",{staticClass:"upload-demo",attrs:{name:"file",action:e.qiniuZone,"on-remove":e.iconRemove,"before-remove":e.beforeIconRemove,"file-list":e.fileList2,data:e.picData,"on-success":e.handleUploadIconSuccess,"before-upload":e.getQiniuToken}},[e.infoForm.icon_url?e._e():t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")])],1),t("div",{staticClass:"form-tip"},[e._v("图片尺寸：图标250*250, 只能上传jpg/png文件")])],1):e._e(),t("el-form-item",{attrs:{label:"排序"}},[t("el-input-number",{attrs:{min:1,max:1e3},model:{value:e.infoForm.sort_order,callback:function(t){e.$set(e.infoForm,"sort_order",t)},expression:"infoForm.sort_order"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.onSubmitInfo}},[e._v("确定保存")]),t("el-button",{on:{click:e.goBackPage}},[e._v("取消")])],1)],1)],1)])])},a=[],o=(i(57658),i(70636)),s=i(48234),l={data(){return{root:"",qiniuZone:"",fileList:[],fileList2:[],parentCategory:[{id:0,name:"顶级分类"}],infoForm:{id:0,name:"",parent_id:0,front_name:"",img_url:"",sort_order:100,icon_url:""},infoRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"}],front_name:[{required:!0,message:"请输入简介",trigger:"blur"}],img_url:[{required:!0,message:"请选择分类图片",trigger:"blur"}],icon_url:[{required:!0,message:"请选择分类图标",trigger:"blur"}]},picData:{token:""},url:""}},methods:{getQiniuToken(){let e=this;this.axios.post("index/getQiniuToken").then((t=>{let i=t.data.data;console.log(i),e.picData.token=i.token,e.url=i.url}))},beforeBannerRemove(e,t){return this.$confirm("确定移除该图？删除后将无法找回")},beforeIconRemove(e,t){return this.$confirm("确定移除图标？删除后将无法找回")},bannerRemove(e,t){this.infoForm.img_url="";let i=this.infoForm.id;this.axios.post("category/deleteBannerImage",{id:i}).then((e=>{this.$message({type:"success",message:"删除成功"})}))},iconRemove(e,t){this.infoForm.icon_url="";let i=this.infoForm.id;this.axios.post("category/deleteIconImage",{id:i}).then((e=>{this.$message({type:"success",message:"删除成功"})}))},goBackPage(){this.$router.go(-1)},onSubmitInfo(){this.infoForm.level=0==this.infoForm.parent_id?"L1":"L2",console.log(this.infoForm.level),this.$refs["infoForm"].validate((e=>{if(!e)return!1;this.axios.post("category/store",this.infoForm).then((e=>{0===e.data.errno?(this.$message({type:"success",message:"保存成功"}),this.$router.go(-1)):this.$message({type:"error",message:"保存失败"})}))}))},handleUploadBannerSuccess(e,t){let i=this.url;this.infoForm.img_url=i+e.key},handleUploadIconSuccess(e,t){let i=this.url;this.infoForm.icon_url=i+e.key},getTopCategory(){this.axios.get("category/topCategory").then((e=>{this.parentCategory=this.parentCategory.concat(e.data.data)}))},getInfo(){if(this.infoForm.id<=0)return!1;let e=this;this.axios.get("category/info",{params:{id:e.infoForm.id}}).then((t=>{let i=t.data.data;console.log(i);let r={name:"分类图",url:i.img_url};this.fileList.push(r);let a={name:"图标",url:i.icon_url};this.fileList2.push(a),e.infoForm=i}))}},components:{ElFormItem:s.Z},mounted(){this.getTopCategory(),this.infoForm.id=this.$route.query.id||0,this.getInfo(),this.root=o.Z.rootUrl,this.qiniuZone=o.Z.qiniu,this.getQiniuToken()}},n=l,d=i(1001),m=(0,d.Z)(n,r,a,!1,null,"845ffc52",null),h=m.exports},72079:function(e,t,i){function r(e){for(let t=1,i=arguments.length;t<i;t++){let i=arguments[t]||{};for(let t in i)if(i.hasOwnProperty(t)){let r=i[t];void 0!==r&&(e[t]=r)}}return e}i.d(t,{Z:function(){return r}})}}]);
//# sourceMappingURL=564.597ab4ae.js.map